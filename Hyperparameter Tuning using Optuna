{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "59255833",
   "metadata": {
    "_cell_guid": "b1076dfc-b9ad-4769-8c92-a6c4dae69d19",
    "_uuid": "8f2839f25d086af736a60e9eeb907d3b93b6e0e5",
    "execution": {
     "iopub.execute_input": "2025-07-29T01:20:08.722395Z",
     "iopub.status.busy": "2025-07-29T01:20:08.722085Z",
     "iopub.status.idle": "2025-07-29T01:21:27.054577Z",
     "shell.execute_reply": "2025-07-29T01:21:27.053720Z"
    },
    "papermill": {
     "duration": 78.338658,
     "end_time": "2025-07-29T01:21:27.056238",
     "exception": false,
     "start_time": "2025-07-29T01:20:08.717580",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m363.4/363.4 MB\u001b[0m \u001b[31m4.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m13.8/13.8 MB\u001b[0m \u001b[31m65.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m24.6/24.6 MB\u001b[0m \u001b[31m69.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m883.7/883.7 kB\u001b[0m \u001b[31m39.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m664.8/664.8 MB\u001b[0m \u001b[31m2.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m211.5/211.5 MB\u001b[0m \u001b[31m2.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m56.3/56.3 MB\u001b[0m \u001b[31m29.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m127.9/127.9 MB\u001b[0m \u001b[31m13.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m207.5/207.5 MB\u001b[0m \u001b[31m7.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m21.1/21.1 MB\u001b[0m \u001b[31m67.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n",
      "\u001b[?25h"
     ]
    }
   ],
   "source": [
    "!pip install -q torch torchvision opencv-python numpy Pillow matplotlib albumentations tqdm  scikit-learn tensorboard optuna"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31ce2226",
   "metadata": {
    "papermill": {
     "duration": 0.022316,
     "end_time": "2025-07-29T01:21:27.104414",
     "exception": false,
     "start_time": "2025-07-29T01:21:27.082098",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## Config Class"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "415cff66",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-07-29T01:21:27.151162Z",
     "iopub.status.busy": "2025-07-29T01:21:27.150851Z",
     "iopub.status.idle": "2025-07-29T01:21:27.159058Z",
     "shell.execute_reply": "2025-07-29T01:21:27.158439Z"
    },
    "papermill": {
     "duration": 0.033236,
     "end_time": "2025-07-29T01:21:27.160134",
     "exception": false,
     "start_time": "2025-07-29T01:21:27.126898",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "Configuration file for Facial Detection System\n",
    "Optimized for Kaggle hardware constraints\n",
    "\"\"\"\n",
    "\n",
    "import os\n",
    "\n",
    "class Config:\n",
    "    # Hardware constraints for Kaggle\n",
    "    GPU_MEMORY_LIMIT = 14  # GB (leaving 2GB buffer)\n",
    "    RAM_LIMIT = 28  # GB (leaving 4GB buffer)\n",
    "    CPU_CORES = 4\n",
    "    \n",
    "    # Dataset settings\n",
    "    DATASET_NAME = \"davido-recognition\"  # Custom Davido recognition dataset\n",
    "    TRAIN_SPLIT = 0.8\n",
    "    VAL_SPLIT = 0.2\n",
    "    IMAGE_SIZE = (160, 160)  # Standard for face recognition models (e.g., FaceNet)\n",
    "    BATCH_SIZE = 16  # Optimized for P100 GPU memory\n",
    "    DAVIDO_LABEL = \"Davido\"\n",
    "    UNKNOWN_LABEL = \"Unknown\"\n",
    "    CLASS_NAMES = [DAVIDO_LABEL, UNKNOWN_LABEL]\n",
    "    NUM_CLASSES = 2\n",
    "    \n",
    "    # Data augmentation settings\n",
    "    AUGMENTATION_PROBABILITY = 0.8\n",
    "    ROTATION_RANGE = 15\n",
    "    BRIGHTNESS_RANGE = 0.2\n",
    "    CONTRAST_RANGE = 0.2\n",
    "    HORIZONTAL_FLIP_PROB = 0.5\n",
    "    VERTICAL_FLIP_PROB = 0.0  # Keep faces upright\n",
    "    \n",
    "    # Model settings\n",
    "    MODEL_TYPE = \"mobilenet_v2\"  # Lightweight and efficient for classification\n",
    "    PRETRAINED = True\n",
    "    CONFIDENCE_THRESHOLD = 0.8  # Higher threshold to reduce false positives\n",
    "    NMS_THRESHOLD = 0.4\n",
    "    \n",
    "    # Training settings (optimized for larger dataset)\n",
    "    EPOCHS = 100  # More epochs for larger dataset\n",
    "    LEARNING_RATE = 0.001\n",
    "    WEIGHT_DECAY = 1e-4\n",
    "    SCHEDULER_STEP_SIZE = 15\n",
    "    SCHEDULER_GAMMA = 0.5\n",
    "    \n",
    "    # Early stopping settings (adjusted for larger dataset)\n",
    "    EARLY_STOPPING_PATIENCE = 15  # More patience for larger dataset\n",
    "    EARLY_STOPPING_MIN_DELTA = 0.0005  # Smaller improvement threshold\n",
    "    \n",
    "    # Real-time detection settings\n",
    "    FPS_TARGET = 15  # Process every 4th frame at 60fps\n",
    "    FRAME_SKIP = 4\n",
    "    DETECTION_INTERVAL = 3  # frames between detections\n",
    "    \n",
    "    # Paths (Updated for Kaggle)\n",
    "    DATA_DIR = \"/kaggle/input/input-data\"  # Kaggle data directory\n",
    "    SCREENSHOT_DIR = \"./output/screenshots\"\n",
    "    MODELS_DIR = \"./models\"\n",
    "    LOGS_DIR = \"./logs\"\n",
    "    OUTPUT_DIR = \"./output\"\n",
    "    \n",
    "    # Create directories\n",
    "    @staticmethod\n",
    "    def create_directories():\n",
    "        \"\"\"Create necessary directories\"\"\"\n",
    "        dirs = [Config.DATA_DIR, Config.MODELS_DIR, Config.LOGS_DIR, Config.OUTPUT_DIR, Config.SCREENSHOT_DIR]\n",
    "        for dir_path in dirs:\n",
    "            os.makedirs(dir_path, exist_ok=True)\n",
    "    \n",
    "    # Model export settings\n",
    "    EXPORT_FORMAT = \"pt\"  # PyTorch format for local use\n",
    "    MODEL_FILENAME = \"face_detection_model.pt\" "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7f25c63f",
   "metadata": {
    "papermill": {
     "duration": 0.022718,
     "end_time": "2025-07-29T01:21:27.206740",
     "exception": false,
     "start_time": "2025-07-29T01:21:27.184022",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## Data Utility Class"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "a4612e52",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-07-29T01:21:27.254654Z",
     "iopub.status.busy": "2025-07-29T01:21:27.254379Z",
     "iopub.status.idle": "2025-07-29T01:21:36.053940Z",
     "shell.execute_reply": "2025-07-29T01:21:36.053302Z"
    },
    "papermill": {
     "duration": 8.825763,
     "end_time": "2025-07-29T01:21:36.055365",
     "exception": false,
     "start_time": "2025-07-29T01:21:27.229602",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "Utility functions to load dataset information saved by data_preparation.py\n",
    "Used by hyperparameter tuning and training stages\n",
    "\"\"\"\n",
    "\n",
    "import os\n",
    "import pickle\n",
    "import json\n",
    "import torch\n",
    "from torch.utils.data import Dataset, DataLoader\n",
    "from torchvision import transforms\n",
    "from PIL import Image\n",
    "# from config import Config\n",
    "\n",
    "class FaceRecognitionDataset(Dataset):\n",
    "    \"\"\"\n",
    "    Custom dataset for face recognition (classification)\n",
    "    Loads images and labels from saved splits with augmentation\n",
    "    \"\"\"\n",
    "    def __init__(self, data_dir, samples, transform=None, augment_factor=10):\n",
    "        self.data_dir = data_dir\n",
    "        self.transform = transform\n",
    "        self.samples = samples\n",
    "        self.class_names = Config.CLASS_NAMES\n",
    "        self.augment_factor = augment_factor\n",
    "        \n",
    "        # Create balanced dataset with synthetic negative samples\n",
    "        self.balanced_samples = self._create_balanced_samples()\n",
    "        \n",
    "        # Create augmented samples\n",
    "        self.augmented_samples = self._create_augmented_samples()\n",
    "    \n",
    "    def _create_balanced_samples(self):\n",
    "        \"\"\"Use real samples from the dataset\"\"\"\n",
    "        # Simply return the original samples since we now have real negative samples\n",
    "        return self.samples\n",
    "    \n",
    "    def _create_augmented_samples(self):\n",
    "        \"\"\"Create multiple augmented versions of each image\"\"\"\n",
    "        augmented_samples = []\n",
    "        \n",
    "        for filename, label in self.balanced_samples:\n",
    "            # Add original sample\n",
    "            augmented_samples.append((filename, label, 0))  # 0 = original\n",
    "            \n",
    "            # Add augmented versions\n",
    "            for i in range(1, self.augment_factor):\n",
    "                augmented_samples.append((filename, label, i))  # i = augmented version\n",
    "        \n",
    "        return augmented_samples\n",
    "    \n",
    "    def __len__(self):\n",
    "        return len(self.augmented_samples)\n",
    "    \n",
    "    def __getitem__(self, idx):\n",
    "        fname, label, aug_idx = self.augmented_samples[idx]\n",
    "        \n",
    "        # Construct correct path based on label\n",
    "        if label == 'Davido':\n",
    "            img_path = os.path.join(self.data_dir, 'Davido', fname)\n",
    "        else:  # Unknown\n",
    "            img_path = os.path.join(self.data_dir, 'Unknown', fname)\n",
    "        \n",
    "        # Debug: Check if file exists\n",
    "        if not os.path.exists(img_path):\n",
    "            print(f\"❌ File not found: {img_path}\")\n",
    "            print(f\"  Filename: {fname}\")\n",
    "            print(f\"  Label: {label}\")\n",
    "            print(f\"  Data dir: {self.data_dir}\")\n",
    "            raise FileNotFoundError(f\"Image file not found: {img_path}\")\n",
    "        \n",
    "        image = Image.open(img_path).convert('RGB')\n",
    "        label_idx = self.class_names.index(label)\n",
    "        \n",
    "        # Apply different augmentation based on aug_idx and label\n",
    "        if aug_idx == 0:\n",
    "            # Original image with minimal transforms\n",
    "            if self.transform:\n",
    "                image = self.transform(image)\n",
    "        else:\n",
    "            # Apply heavy augmentation\n",
    "            image = self._apply_augmentation(image, aug_idx, label)\n",
    "        \n",
    "        return {'image': image, 'label': label_idx, 'image_path': img_path}\n",
    "    \n",
    "    def _apply_augmentation(self, image, aug_idx, label):\n",
    "        \"\"\"Apply different augmentation based on index and label\"\"\"\n",
    "        # Set random seed for reproducible augmentation\n",
    "        import random\n",
    "        import numpy as np\n",
    "        random.seed(aug_idx)\n",
    "        np.random.seed(aug_idx)\n",
    "        \n",
    "        if label == 'Unknown':\n",
    "            # Apply very heavy augmentation for synthetic negative samples\n",
    "            aug_transform = transforms.Compose([\n",
    "                transforms.Resize((Config.IMAGE_SIZE[0] + 40, Config.IMAGE_SIZE[1] + 40)),\n",
    "                transforms.RandomCrop(Config.IMAGE_SIZE),\n",
    "                transforms.RandomHorizontalFlip(p=0.8),\n",
    "                transforms.RandomRotation(degrees=45),\n",
    "                transforms.ColorJitter(brightness=0.5, contrast=0.5, saturation=0.5, hue=0.3),\n",
    "                transforms.RandomGrayscale(p=0.3),\n",
    "                transforms.RandomAffine(degrees=30, translate=(0.2, 0.2), scale=(0.7, 1.3)),\n",
    "                transforms.ToTensor(),\n",
    "                transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5]),\n",
    "                transforms.RandomErasing(p=0.4, scale=(0.1, 0.3)),\n",
    "            ])\n",
    "        else:\n",
    "            # Apply moderate augmentation for Davido samples\n",
    "            aug_transform = transforms.Compose([\n",
    "                transforms.Resize((Config.IMAGE_SIZE[0] + 20, Config.IMAGE_SIZE[1] + 20)),\n",
    "                transforms.RandomCrop(Config.IMAGE_SIZE),\n",
    "                transforms.RandomHorizontalFlip(p=0.5),\n",
    "                transforms.RandomRotation(degrees=15),\n",
    "                transforms.ColorJitter(brightness=0.3, contrast=0.3, saturation=0.3, hue=0.1),\n",
    "                transforms.RandomGrayscale(p=0.1),\n",
    "                transforms.RandomAffine(degrees=0, translate=(0.1, 0.1), scale=(0.9, 1.1)),\n",
    "                transforms.ToTensor(),\n",
    "                transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5]),\n",
    "                transforms.RandomErasing(p=0.2, scale=(0.02, 0.2)),\n",
    "            ])\n",
    "        \n",
    "        return aug_transform(image)\n",
    "\n",
    "def get_transforms():\n",
    "    \"\"\"Comprehensive data augmentation for small datasets\"\"\"\n",
    "    return transforms.Compose([\n",
    "        transforms.Resize((Config.IMAGE_SIZE[0] + 20, Config.IMAGE_SIZE[1] + 20)),  # Slightly larger for cropping\n",
    "        transforms.RandomCrop(Config.IMAGE_SIZE),  # Random crop\n",
    "        transforms.RandomHorizontalFlip(p=0.5),  # Random horizontal flip\n",
    "        transforms.RandomRotation(degrees=15),  # Random rotation\n",
    "        transforms.ColorJitter(brightness=0.3, contrast=0.3, saturation=0.3, hue=0.1),  # Color augmentation\n",
    "        transforms.RandomGrayscale(p=0.1),  # Random grayscale\n",
    "        transforms.RandomAffine(degrees=0, translate=(0.1, 0.1), scale=(0.9, 1.1)),  # Affine transforms\n",
    "        transforms.ToTensor(),\n",
    "        transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5]),\n",
    "        transforms.RandomErasing(p=0.2, scale=(0.02, 0.2)),  # Random erasing\n",
    "    ])\n",
    "\n",
    "def get_val_transforms():\n",
    "    \"\"\"Simple transforms for validation (no augmentation)\"\"\"\n",
    "    return transforms.Compose([\n",
    "        transforms.Resize(Config.IMAGE_SIZE),\n",
    "        transforms.ToTensor(),\n",
    "        transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5]),\n",
    "    ])\n",
    "\n",
    "def load_dataset_info():\n",
    "    \"\"\"Load dataset information saved by data_preparation.py\"\"\"\n",
    "    # Try multiple possible paths\n",
    "    possible_paths = [\n",
    "        os.path.join(Config.OUTPUT_DIR, 'dataset_info.json'),\n",
    "        os.path.join('/kaggle/input/fd-01-preprocessing/output', 'dataset_info.json'),\n",
    "        './output/dataset_info.json'\n",
    "    ]\n",
    "    \n",
    "    info_path = None\n",
    "    for path in possible_paths:\n",
    "        if os.path.exists(path):\n",
    "            info_path = path\n",
    "            break\n",
    "    \n",
    "    if info_path is None:\n",
    "        raise FileNotFoundError(f\"Dataset info not found. Tried: {possible_paths}. Run data_preparation.py first.\")\n",
    "    \n",
    "    with open(info_path, 'r') as f:\n",
    "        dataset_info = json.load(f)\n",
    "    \n",
    "    print(f\"Loaded dataset info:\")\n",
    "    print(f\"  Total samples: {dataset_info['total_samples']}\")\n",
    "    print(f\"  Classes: {dataset_info['class_names']}\")\n",
    "    print(f\"  Class distribution: {dataset_info['class_distribution']}\")\n",
    "    \n",
    "    return dataset_info\n",
    "\n",
    "def load_dataset_splits():\n",
    "    \"\"\"Load train/val splits saved by data_preparation.py\"\"\"\n",
    "    # Try multiple possible paths\n",
    "    possible_paths = [\n",
    "        os.path.join(Config.OUTPUT_DIR, 'dataset_splits.pkl'),\n",
    "        os.path.join('/kaggle/input/fd-01-preprocessing/output', 'dataset_splits.pkl'),\n",
    "        './output/dataset_splits.pkl'\n",
    "    ]\n",
    "    \n",
    "    splits_path = None\n",
    "    for path in possible_paths:\n",
    "        if os.path.exists(path):\n",
    "            splits_path = path\n",
    "            break\n",
    "    \n",
    "    if splits_path is None:\n",
    "        raise FileNotFoundError(f\"Dataset splits not found. Tried: {possible_paths}. Run data_preparation.py first.\")\n",
    "    \n",
    "    with open(splits_path, 'rb') as f:\n",
    "        splits_data = pickle.load(f)\n",
    "    \n",
    "    return splits_data['train_samples'], splits_data['val_samples'], splits_data['class_names']\n",
    "\n",
    "def create_data_loaders(batch_size=None, num_workers=None):\n",
    "    \"\"\"Create train and validation data loaders from saved splits\"\"\"\n",
    "    if batch_size is None:\n",
    "        batch_size = Config.BATCH_SIZE\n",
    "    if num_workers is None:\n",
    "        num_workers = min(Config.CPU_CORES, 4)\n",
    "    \n",
    "    # Load saved splits\n",
    "    train_samples, val_samples, class_names = load_dataset_splits()\n",
    "    \n",
    "    # Create datasets\n",
    "    train_dataset = FaceRecognitionDataset(\n",
    "        Config.DATA_DIR,\n",
    "        train_samples,\n",
    "        transform=get_transforms()\n",
    "    )\n",
    "    \n",
    "    val_dataset = FaceRecognitionDataset(\n",
    "        Config.DATA_DIR,\n",
    "        val_samples,\n",
    "        transform=get_val_transforms()\n",
    "    )\n",
    "    \n",
    "    # Create data loaders\n",
    "    train_loader = DataLoader(\n",
    "        train_dataset,\n",
    "        batch_size=batch_size,\n",
    "        shuffle=True,\n",
    "        num_workers=num_workers,\n",
    "        pin_memory=True,\n",
    "        drop_last=True\n",
    "    )\n",
    "    \n",
    "    val_loader = DataLoader(\n",
    "        val_dataset,\n",
    "        batch_size=batch_size,\n",
    "        shuffle=False,\n",
    "        num_workers=num_workers,\n",
    "        pin_memory=True\n",
    "    )\n",
    "    \n",
    "    print(f\"Created data loaders:\")\n",
    "    print(f\"  Training: {len(train_loader)} batches\")\n",
    "    print(f\"  Validation: {len(val_loader)} batches\")\n",
    "    \n",
    "    return train_loader, val_loader\n",
    "\n",
    "def test_data_loading():\n",
    "    \"\"\"Test function to verify data loading works\"\"\"\n",
    "    try:\n",
    "        dataset_info = load_dataset_info()\n",
    "        train_loader, val_loader = create_data_loaders()\n",
    "        \n",
    "        # Test a batch\n",
    "        for batch in train_loader:\n",
    "            print(f\"Test batch shape: {batch['image'].shape}\")\n",
    "            print(f\"Test batch labels: {batch['label']}\")\n",
    "            break\n",
    "        \n",
    "        print(\"✓ Data loading test successful!\")\n",
    "        return True\n",
    "    except Exception as e:\n",
    "        print(f\"✗ Data loading test failed: {e}\")\n",
    "        return False\n",
    "\n",
    "# if __name__ == \"__main__\":\n",
    "#     test_data_loading() "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d4acc04a",
   "metadata": {
    "papermill": {
     "duration": 0.021828,
     "end_time": "2025-07-29T01:21:36.099878",
     "exception": false,
     "start_time": "2025-07-29T01:21:36.078050",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## Model Training Class"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "0a5c93b7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-07-29T01:21:36.146581Z",
     "iopub.status.busy": "2025-07-29T01:21:36.146166Z",
     "iopub.status.idle": "2025-07-29T01:21:54.010631Z",
     "shell.execute_reply": "2025-07-29T01:21:54.009753Z"
    },
    "papermill": {
     "duration": 17.889852,
     "end_time": "2025-07-29T01:21:54.012109",
     "exception": false,
     "start_time": "2025-07-29T01:21:36.122257",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2025-07-29 01:21:39.024686: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered\n",
      "WARNING: All log messages before absl::InitializeLog() is called are written to STDERR\n",
      "E0000 00:00:1753752099.289692      19 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered\n",
      "E0000 00:00:1753752099.408677      19 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered\n"
     ]
    }
   ],
   "source": [
    "\"\"\"\n",
    "Section 2: Model Selection and Training\n",
    "Lightweight face detection model optimized for real-time processing on Kaggle hardware\n",
    "\"\"\"\n",
    "\n",
    "import os\n",
    "import torch\n",
    "import torch.nn as nn\n",
    "import torch.optim as optim\n",
    "from torch.utils.tensorboard import SummaryWriter\n",
    "import torchvision.models as models\n",
    "from tqdm import tqdm\n",
    "import matplotlib.pyplot as plt\n",
    "import time\n",
    "# from config import Config\n",
    "# from data_loader_utils import create_data_loaders\n",
    "\n",
    "# Utility function to load best learning rate if available\n",
    "def get_best_learning_rate():\n",
    "    best_lr_path = os.path.join(\"/kaggle/input/fd-02-hyperparam-tuning/output\", \"best_learning_rate.txt\")\n",
    "    if os.path.exists(best_lr_path):\n",
    "        try:\n",
    "            with open(best_lr_path, \"r\") as f:\n",
    "                lr = float(f.read().strip())\n",
    "                print(f\"[INFO] Using best learning rate from tuning: {lr}\")\n",
    "                return lr\n",
    "        except Exception as e:\n",
    "            print(f\"[WARN] Could not read best learning rate: {e}. Using default.\")\n",
    "    print(f\"[INFO] Using default learning rate: {Config.LEARNING_RATE}\")\n",
    "    return Config.LEARNING_RATE\n",
    "\n",
    "def get_best_hyperparameters():\n",
    "    \"\"\"Load best hyperparameters from tuning stage\"\"\"\n",
    "    best_params_path = os.path.join(\"/kaggle/input/fd-02-hyperparam-tuning/output\", \"best_hyperparameters.json\")\n",
    "    if os.path.exists(best_params_path):\n",
    "        try:\n",
    "            import json\n",
    "            with open(best_params_path, \"r\") as f:\n",
    "                params = json.load(f)\n",
    "            print(f\"[INFO] Using best hyperparameters from tuning:\")\n",
    "            for key, value in params.items():\n",
    "                print(f\"  {key}: {value}\")\n",
    "            return params\n",
    "        except Exception as e:\n",
    "            print(f\"[WARN] Could not read best hyperparameters: {e}. Using defaults.\")\n",
    "    \n",
    "    # Return default parameters\n",
    "    default_params = {\n",
    "        'learning_rate': Config.LEARNING_RATE,\n",
    "        'batch_size': Config.BATCH_SIZE,\n",
    "        'weight_decay': Config.WEIGHT_DECAY,\n",
    "        'scheduler_step_size': Config.SCHEDULER_STEP_SIZE\n",
    "    }\n",
    "    print(f\"[INFO] Using default hyperparameters\")\n",
    "    return default_params\n",
    "\n",
    "class FaceRecognitionModel(nn.Module):\n",
    "    \"\"\"\n",
    "    Simple face recognition model for classifying Davido vs Unknown\n",
    "    Uses MobileNetV2 backbone with a classification head\n",
    "    \"\"\"\n",
    "    def __init__(self, num_classes=2, pretrained=True):\n",
    "        super().__init__()\n",
    "        self.backbone = models.mobilenet_v2(pretrained=pretrained).features\n",
    "        self.pool = nn.AdaptiveAvgPool2d((1, 1))\n",
    "        self.classifier = nn.Sequential(\n",
    "            nn.Dropout(0.2),\n",
    "            nn.Linear(1280, num_classes)\n",
    "        )\n",
    "    def forward(self, x):\n",
    "        x = self.backbone(x)\n",
    "        x = self.pool(x)\n",
    "        x = x.view(x.size(0), -1)\n",
    "        x = self.classifier(x)\n",
    "        return x\n",
    "\n",
    "class ModelTrainer:\n",
    "    \"\"\"\n",
    "    Handles model training for face recognition (classification)\n",
    "    \"\"\"\n",
    "    def __init__(self, model, train_loader, val_loader):\n",
    "        self.model = model\n",
    "        self.train_loader = train_loader\n",
    "        self.val_loader = val_loader\n",
    "        self.device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')\n",
    "        self.model.to(self.device)\n",
    "        \n",
    "        # Load best hyperparameters\n",
    "        best_params = get_best_hyperparameters()\n",
    "        \n",
    "        # Initialize optimizer and scheduler with best parameters\n",
    "        self.optimizer = optim.AdamW(\n",
    "            self.model.parameters(),\n",
    "            lr=best_params['learning_rate'],\n",
    "            weight_decay=best_params['weight_decay']\n",
    "        )\n",
    "        \n",
    "        self.scheduler = optim.lr_scheduler.StepLR(\n",
    "            self.optimizer,\n",
    "            step_size=best_params['scheduler_step_size'],\n",
    "            gamma=Config.SCHEDULER_GAMMA\n",
    "        )\n",
    "        \n",
    "        self.criterion = nn.CrossEntropyLoss()\n",
    "        self.writer = SummaryWriter(Config.LOGS_DIR)\n",
    "        self.train_losses = []\n",
    "        self.val_losses = []\n",
    "        self.best_val_loss = float('inf')\n",
    "        \n",
    "        # Early stopping parameters\n",
    "        self.patience = Config.EARLY_STOPPING_PATIENCE\n",
    "        self.min_delta = Config.EARLY_STOPPING_MIN_DELTA\n",
    "        self.counter = 0  # Counter for epochs without improvement\n",
    "        self.early_stop = False  # Flag to stop training\n",
    "        \n",
    "        # Debug model and loss function\n",
    "        print(f\"Model initialized on device: {self.device}\")\n",
    "        print(f\"Total parameters: {sum(p.numel() for p in self.model.parameters()):,}\")\n",
    "        print(f\"Learning rate: {best_params['learning_rate']:.6f}\")\n",
    "        print(f\"Weight decay: {best_params['weight_decay']:.6f}\")\n",
    "        print(f\"Loss function: {self.criterion}\")\n",
    "        print(f\"Early stopping patience: {self.patience}\")\n",
    "        print(f\"Early stopping min delta: {self.min_delta}\")\n",
    "        \n",
    "        # Test model with dummy input\n",
    "        dummy_input = torch.randn(1, 3, Config.IMAGE_SIZE[0], Config.IMAGE_SIZE[1]).to(self.device)\n",
    "        dummy_output = self.model(dummy_input)\n",
    "        print(f\"Model test - Input shape: {dummy_input.shape}\")\n",
    "        print(f\"Model test - Output shape: {dummy_output.shape}\")\n",
    "        print(f\"Model test - Output range: [{dummy_output.min().item():.4f}, {dummy_output.max().item():.4f}]\")\n",
    "        \n",
    "        # Test loss function\n",
    "        dummy_labels = torch.randint(0, Config.NUM_CLASSES, (1,)).to(self.device)\n",
    "        dummy_loss = self.criterion(dummy_output, dummy_labels)\n",
    "        print(f\"Loss test - Labels: {dummy_labels}\")\n",
    "        print(f\"Loss test - Loss value: {dummy_loss.item():.6f}\")\n",
    "    \n",
    "    def check_early_stopping(self, val_loss):\n",
    "        \"\"\"Check if training should stop early\"\"\"\n",
    "        if val_loss < self.best_val_loss - self.min_delta:\n",
    "            self.best_val_loss = val_loss\n",
    "            self.counter = 0\n",
    "            return False  # Continue training\n",
    "        else:\n",
    "            self.counter += 1\n",
    "            if self.counter >= self.patience:\n",
    "                return True  # Stop training\n",
    "            return False  # Continue training\n",
    "    def train_epoch(self, epoch):\n",
    "        \"\"\"Train for one epoch\"\"\"\n",
    "        self.model.train()\n",
    "        total_loss = 0.0\n",
    "        num_batches = 0\n",
    "        \n",
    "        # Check if train_loader is empty\n",
    "        if len(self.train_loader) == 0:\n",
    "            print(\"[ERROR] Training loader is empty!\")\n",
    "            return 0.0\n",
    "        \n",
    "        for batch_idx, batch in enumerate(self.train_loader):\n",
    "            # Handle dictionary format from dataset\n",
    "            if isinstance(batch, dict):\n",
    "                images = batch['image'].to(self.device)\n",
    "                labels = batch['label'].to(self.device)\n",
    "            else:\n",
    "                # Handle tuple format (images, labels)\n",
    "                images, labels = batch\n",
    "                images = images.to(self.device)\n",
    "                labels = labels.to(self.device)\n",
    "            \n",
    "            self.optimizer.zero_grad()\n",
    "            outputs = self.model(images)\n",
    "            loss = self.criterion(outputs, labels)\n",
    "            loss.backward()\n",
    "            self.optimizer.step()\n",
    "            \n",
    "            # Debug information for first few batches\n",
    "            if batch_idx < 3:  # Print first 3 batches info\n",
    "                print(f\"[DEBUG] Training batch {batch_idx}:\")\n",
    "                print(f\"  Images shape: {images.shape}\")\n",
    "                print(f\"  Labels: {labels}\")\n",
    "                print(f\"  Outputs shape: {outputs.shape}\")\n",
    "                print(f\"  Outputs range: [{outputs.min().item():.4f}, {outputs.max().item():.4f}]\")\n",
    "                print(f\"  Loss value: {loss.item():.6f}\")\n",
    "                print(f\"  Predicted classes: {torch.argmax(outputs, dim=1)}\")\n",
    "            \n",
    "            total_loss += loss.item()\n",
    "            num_batches += 1\n",
    "            \n",
    "            if batch_idx % 10 == 0:\n",
    "                self.writer.add_scalar('Train/Loss', loss.item(), epoch * len(self.train_loader) + batch_idx)\n",
    "        \n",
    "        # Prevent division by zero\n",
    "        if num_batches == 0:\n",
    "            print(\"[ERROR] No batches processed in training epoch!\")\n",
    "            return 0.0\n",
    "            \n",
    "        avg_loss = total_loss / num_batches\n",
    "        self.train_losses.append(avg_loss)\n",
    "        \n",
    "        # Debug final training loss\n",
    "        print(f\"[DEBUG] Training epoch {epoch}:\")\n",
    "        print(f\"  Total loss: {total_loss:.6f}\")\n",
    "        print(f\"  Num batches: {num_batches}\")\n",
    "        print(f\"  Average loss: {avg_loss:.6f}\")\n",
    "        \n",
    "        return avg_loss\n",
    "    def validate_epoch(self, epoch):\n",
    "        \"\"\"Validate for one epoch\"\"\"\n",
    "        self.model.eval()\n",
    "        total_loss = 0.0\n",
    "        num_batches = 0\n",
    "        \n",
    "        # Check if val_loader is empty\n",
    "        if len(self.val_loader) == 0:\n",
    "            print(\"[ERROR] Validation loader is empty!\")\n",
    "            return 0.0\n",
    "        \n",
    "        with torch.no_grad():\n",
    "            for batch_idx, batch in enumerate(self.val_loader):\n",
    "                # Handle dictionary format from dataset\n",
    "                if isinstance(batch, dict):\n",
    "                    images = batch['image'].to(self.device)\n",
    "                    labels = batch['label'].to(self.device)\n",
    "                else:\n",
    "                    # Handle tuple format (images, labels)\n",
    "                    images, labels = batch\n",
    "                    images = images.to(self.device)\n",
    "                    labels = labels.to(self.device)\n",
    "                \n",
    "                outputs = self.model(images)\n",
    "                loss = self.criterion(outputs, labels)\n",
    "                \n",
    "                # Debug information\n",
    "                if batch_idx == 0:  # Print first batch info\n",
    "                    print(f\"[DEBUG] Validation batch {batch_idx}:\")\n",
    "                    print(f\"  Images shape: {images.shape}\")\n",
    "                    print(f\"  Labels: {labels}\")\n",
    "                    print(f\"  Outputs shape: {outputs.shape}\")\n",
    "                    print(f\"  Outputs range: [{outputs.min().item():.4f}, {outputs.max().item():.4f}]\")\n",
    "                    print(f\"  Loss value: {loss.item():.6f}\")\n",
    "                    print(f\"  Predicted classes: {torch.argmax(outputs, dim=1)}\")\n",
    "                \n",
    "                total_loss += loss.item()\n",
    "                num_batches += 1\n",
    "                \n",
    "                if batch_idx % 10 == 0:\n",
    "                    self.writer.add_scalar('Val/Loss', loss.item(), epoch * len(self.val_loader) + batch_idx)\n",
    "        \n",
    "        # Prevent division by zero\n",
    "        if num_batches == 0:\n",
    "            print(\"[ERROR] No batches processed in validation epoch!\")\n",
    "            return 0.0\n",
    "            \n",
    "        avg_loss = total_loss / num_batches\n",
    "        self.val_losses.append(avg_loss)\n",
    "        \n",
    "        # Debug final validation loss\n",
    "        print(f\"[DEBUG] Validation epoch {epoch}:\")\n",
    "        print(f\"  Total loss: {total_loss:.6f}\")\n",
    "        print(f\"  Num batches: {num_batches}\")\n",
    "        print(f\"  Average loss: {avg_loss:.6f}\")\n",
    "        \n",
    "        return avg_loss\n",
    "    def save_checkpoint(self, epoch, is_best=False):\n",
    "        # Ensure models directory exists\n",
    "        os.makedirs(Config.MODELS_DIR, exist_ok=True)\n",
    "        \n",
    "        checkpoint = {\n",
    "            'epoch': epoch,\n",
    "            'model_state_dict': self.model.state_dict(),\n",
    "            'optimizer_state_dict': self.optimizer.state_dict(),\n",
    "            'scheduler_state_dict': self.scheduler.state_dict(),\n",
    "            'train_losses': self.train_losses,\n",
    "            'val_losses': self.val_losses,\n",
    "            'best_val_loss': self.best_val_loss\n",
    "        }\n",
    "        checkpoint_path = os.path.join(Config.MODELS_DIR, f'checkpoint_epoch_{epoch}.pt')\n",
    "        torch.save(checkpoint, checkpoint_path)\n",
    "        if is_best:\n",
    "            best_path = os.path.join(Config.MODELS_DIR, 'best_model.pt')\n",
    "            torch.save(checkpoint, best_path)\n",
    "            print(f\"Saved best model with validation loss: {self.best_val_loss:.4f}\")\n",
    "    def train(self):\n",
    "        print(\"Starting training...\")\n",
    "        print(f\"Training for {Config.EPOCHS} epochs (with early stopping)\")\n",
    "        print(f\"Learning rate: {self.optimizer.param_groups[0]['lr']}\")\n",
    "        print(f\"Batch size: {Config.BATCH_SIZE}\")\n",
    "        print(f\"Early stopping patience: {self.patience}\")\n",
    "        \n",
    "        for epoch in range(Config.EPOCHS):\n",
    "            train_loss = self.train_epoch(epoch)\n",
    "            val_loss = self.validate_epoch(epoch)\n",
    "            self.scheduler.step()\n",
    "            \n",
    "            # Check for best model\n",
    "            is_best = val_loss < self.best_val_loss\n",
    "            if is_best:\n",
    "                self.best_val_loss = val_loss\n",
    "            \n",
    "            # Check early stopping\n",
    "            should_stop = self.check_early_stopping(val_loss)\n",
    "            \n",
    "            # Save checkpoint periodically or when best\n",
    "            if (epoch + 1) % 5 == 0 or is_best:\n",
    "                self.save_checkpoint(epoch, is_best)\n",
    "            \n",
    "            print(f'Epoch {epoch+1}/{Config.EPOCHS}:')\n",
    "            print(f'  Train Loss: {train_loss:.4f}')\n",
    "            print(f'  Val Loss: {val_loss:.4f}')\n",
    "            print(f'  Learning Rate: {self.scheduler.get_last_lr()[0]:.6f}')\n",
    "            print(f'  Best Val Loss: {self.best_val_loss:.4f}')\n",
    "            print(f'  Early Stop Counter: {self.counter}/{self.patience}')\n",
    "            \n",
    "            if should_stop:\n",
    "                print(f'\\nEarly stopping triggered after {epoch+1} epochs!')\n",
    "                print(f'Best validation loss: {self.best_val_loss:.4f}')\n",
    "                break\n",
    "            \n",
    "            print()\n",
    "        \n",
    "        # Save final checkpoint\n",
    "        self.save_checkpoint(epoch, False)\n",
    "        self.writer.close()\n",
    "        \n",
    "        if should_stop:\n",
    "            print(\"Training stopped early due to no improvement!\")\n",
    "        else:\n",
    "            print(\"Training completed for all epochs!\")\n",
    "        \n",
    "        print(f\"Best validation loss: {self.best_val_loss:.4f}\")\n",
    "        return self.model\n",
    "    def plot_training_history(self):\n",
    "        plt.figure(figsize=(12, 4))\n",
    "        plt.subplot(1, 2, 1)\n",
    "        plt.plot(self.train_losses, label='Train Loss')\n",
    "        plt.plot(self.val_losses, label='Val Loss')\n",
    "        plt.title('Training History')\n",
    "        plt.xlabel('Epoch')\n",
    "        plt.ylabel('Loss')\n",
    "        plt.legend()\n",
    "        plt.grid(True)\n",
    "        plt.tight_layout()\n",
    "        plt.savefig(os.path.join(Config.OUTPUT_DIR, 'training_history.png'))\n",
    "        plt.show()\n",
    "\n",
    "def main():\n",
    "    print(\"=== Section 2: Model Selection and Training ===\")\n",
    "    \n",
    "    # Create necessary directories\n",
    "    Config.create_directories()\n",
    "    \n",
    "    train_loader, val_loader = create_data_loaders()\n",
    "    if train_loader is None or val_loader is None:\n",
    "        print(\"Failed to load data. Please check data preparation.\")\n",
    "        return\n",
    "    model = FaceRecognitionModel(num_classes=Config.NUM_CLASSES, pretrained=Config.PRETRAINED)\n",
    "    trainer = ModelTrainer(model, train_loader, val_loader)\n",
    "    trained_model = trainer.train()\n",
    "    trainer.plot_training_history()\n",
    "    print(\"Model training completed successfully!\")\n",
    "    print(f\"Best validation loss: {trainer.best_val_loss:.4f}\")\n",
    "    print(f\"Model saved to: {Config.MODELS_DIR}\")\n",
    "\n",
    "# if __name__ == \"__main__\":\n",
    "#     main() "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b29c9630",
   "metadata": {
    "papermill": {
     "duration": 0.080521,
     "end_time": "2025-07-29T01:21:54.115307",
     "exception": false,
     "start_time": "2025-07-29T01:21:54.034786",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## Main File"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "d68d942e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-07-29T01:21:54.163362Z",
     "iopub.status.busy": "2025-07-29T01:21:54.162741Z",
     "iopub.status.idle": "2025-07-29T01:23:30.099625Z",
     "shell.execute_reply": "2025-07-29T01:23:30.098614Z"
    },
    "papermill": {
     "duration": 95.962356,
     "end_time": "2025-07-29T01:23:30.100900",
     "exception": false,
     "start_time": "2025-07-29T01:21:54.138544",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:21:54,538] A new study created in memory with name: hyperparameter_tuning\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "=== Hyperparameter Tuning: Multiple Parameters (Optuna) ===\n",
      "Testing data loading...\n",
      "Created data loaders:\n",
      "  Training: 40 batches\n",
      "  Validation: 10 batches\n",
      "Data loading test successful:\n",
      "  Training batches: 40\n",
      "  Validation batches: 10\n",
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.11/dist-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.\n",
      "  warnings.warn(\n",
      "/usr/local/lib/python3.11/dist-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=MobileNet_V2_Weights.IMAGENET1K_V1`. You can also use `weights=MobileNet_V2_Weights.DEFAULT` to get the most up-to-date weights.\n",
      "  warnings.warn(msg)\n",
      "Downloading: \"https://download.pytorch.org/models/mobilenet_v2-b0353104.pth\" to /root/.cache/torch/hub/checkpoints/mobilenet_v2-b0353104.pth\n",
      "100%|██████████| 13.6M/13.6M [00:00<00:00, 70.1MB/s]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.0740, 0.0001]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.730904\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.1623, 0.6012]\n",
      "  Loss value: 0.722143\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.2155, 0.7276]\n",
      "  Loss value: 0.602496\n",
      "  Predicted classes: tensor([1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1,\n",
      "        1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.5204, 1.2974]\n",
      "  Loss value: 0.453620\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0,\n",
      "        1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.778259\n",
      "  Num batches: 3\n",
      "  Average loss: 0.592753\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.2792, 0.9406]\n",
      "  Loss value: 0.591127\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1,\n",
      "        0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.998995\n",
      "  Num batches: 2\n",
      "  Average loss: 0.499497\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0137, 1.8083]\n",
      "  Loss value: 0.209101\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.9390, 1.7927]\n",
      "  Loss value: 0.236562\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.2335, 2.0213]\n",
      "  Loss value: 0.200521\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0,\n",
      "        1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.646184\n",
      "  Num batches: 3\n",
      "  Average loss: 0.215395\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.2576, 1.7690]\n",
      "  Loss value: 0.429905\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1,\n",
      "        0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.721240\n",
      "  Num batches: 2\n",
      "  Average loss: 0.360620\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.6418, 2.5162]\n",
      "  Loss value: 0.086543\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.6544, 2.9783]\n",
      "  Loss value: 0.127167\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.8068, 3.2303]\n",
      "  Loss value: 0.088960\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.302670\n",
      "  Num batches: 3\n",
      "  Average loss: 0.100890\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:03,068] Trial 0 finished with value: 0.3003864735364914 and parameters: {'learning_rate': 0.00011868322339843407, 'batch_size': 64, 'weight_decay': 1.0391095428550823e-05, 'scheduler_step_size': 11}. Best is trial 0 with value: 0.3003864735364914.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.1327, 2.7150]\n",
      "  Loss value: 0.371423\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1,\n",
      "        1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.600773\n",
      "  Num batches: 2\n",
      "  Average loss: 0.300386\n",
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [0.4452, 0.8345]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.906614\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-0.8929, 1.9575]\n",
      "  Loss value: 0.775696\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-0.8072, 2.7353]\n",
      "  Loss value: 0.504987\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.1257, 2.6129]\n",
      "  Loss value: 0.394719\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0,\n",
      "        1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.675402\n",
      "  Num batches: 3\n",
      "  Average loss: 0.558467\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0389, 3.1849]\n",
      "  Loss value: 0.313648\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.635127\n",
      "  Num batches: 2\n",
      "  Average loss: 0.317564\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.1173, 3.6546]\n",
      "  Loss value: 0.143013\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.4413, 4.2064]\n",
      "  Loss value: 0.116673\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.8079, 3.8586]\n",
      "  Loss value: 0.104769\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.364454\n",
      "  Num batches: 3\n",
      "  Average loss: 0.121485\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.5843, 5.2976]\n",
      "  Loss value: 0.267190\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.507422\n",
      "  Num batches: 2\n",
      "  Average loss: 0.253711\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.3753, 3.9198]\n",
      "  Loss value: 0.038812\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.2628, 5.2323]\n",
      "  Loss value: 0.030961\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.8057, 4.7806]\n",
      "  Loss value: 0.025277\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.095050\n",
      "  Num batches: 3\n",
      "  Average loss: 0.031683\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.7050, 6.7289]\n",
      "  Loss value: 0.284699\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.492895\n",
      "  Num batches: 2\n",
      "  Average loss: 0.246447\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:10,362] Trial 1 finished with value: 0.2464473992586136 and parameters: {'learning_rate': 0.0002448673432272898, 'batch_size': 64, 'weight_decay': 7.473886888133567e-05, 'scheduler_step_size': 25}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 40 batches\n",
      "  Validation: 10 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [0.0061, 0.4679]\n",
      "Loss test - Labels: tensor([0], device='cuda:0')\n",
      "Loss test - Loss value: 0.950440\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-0.7164, 1.0509]\n",
      "  Loss value: 0.793715\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-0.8538, 0.5481]\n",
      "  Loss value: 0.745167\n",
      "  Predicted classes: tensor([1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-1.3140, 1.2240]\n",
      "  Loss value: 0.390406\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.929288\n",
      "  Num batches: 3\n",
      "  Average loss: 0.643096\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-1.1215, 0.9147]\n",
      "  Loss value: 0.504601\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.828525\n",
      "  Num batches: 2\n",
      "  Average loss: 0.414263\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-2.0738, 2.7188]\n",
      "  Loss value: 0.084393\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-2.8133, 2.3496]\n",
      "  Loss value: 0.079307\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-2.1922, 2.6114]\n",
      "  Loss value: 0.036648\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.200348\n",
      "  Num batches: 3\n",
      "  Average loss: 0.066783\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-2.1894, 1.9990]\n",
      "  Loss value: 0.445484\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.819240\n",
      "  Num batches: 2\n",
      "  Average loss: 0.409620\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-3.0029, 4.0425]\n",
      "  Loss value: 0.033473\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-3.6116, 3.4616]\n",
      "  Loss value: 0.020569\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-3.3120, 3.1546]\n",
      "  Loss value: 0.008328\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.062370\n",
      "  Num batches: 3\n",
      "  Average loss: 0.020790\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:14,290] Trial 2 finished with value: 0.409620001912117 and parameters: {'learning_rate': 0.00023080294981457086, 'batch_size': 16, 'weight_decay': 4.0020101107313493e-05, 'scheduler_step_size': 17}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-3.0803, 3.0110]\n",
      "  Loss value: 0.498497\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 1.017099\n",
      "  Num batches: 2\n",
      "  Average loss: 0.508550\n",
      "Created data loaders:\n",
      "  Training: 20 batches\n",
      "  Validation: 5 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.3172, 0.2565]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.446887\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-1.3174, 1.2223]\n",
      "  Loss value: 0.759616\n",
      "  Predicted classes: tensor([1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-2.4001, 2.2111]\n",
      "  Loss value: 0.235864\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,\n",
      "        0, 1, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-5.1156, 4.6013]\n",
      "  Loss value: 0.402684\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.398163\n",
      "  Num batches: 3\n",
      "  Average loss: 0.466054\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-13.6738, 14.3511]\n",
      "  Loss value: 3.306190\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1,\n",
      "        1, 1, 0, 0, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 4.596769\n",
      "  Num batches: 2\n",
      "  Average loss: 2.298384\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.9802, 8.8336]\n",
      "  Loss value: 0.264673\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.5415, 9.1648]\n",
      "  Loss value: 0.180454\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0,\n",
      "        1, 1, 0, 1, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,\n",
      "        0, 1, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-11.4360, 11.2157]\n",
      "  Loss value: 0.177757\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,\n",
      "        0, 1, 1, 1, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.622883\n",
      "  Num batches: 3\n",
      "  Average loss: 0.207628\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-15.5011, 16.3159]\n",
      "  Loss value: 2.202653\n",
      "  Predicted classes: tensor([1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 2.882394\n",
      "  Num batches: 2\n",
      "  Average loss: 1.441197\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.2054, 8.7348]\n",
      "  Loss value: 0.094554\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.9325, 9.4909]\n",
      "  Loss value: 0.008375\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,\n",
      "        0, 1, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-10.9869, 10.4347]\n",
      "  Loss value: 0.045486\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,\n",
      "        0, 1, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.148416\n",
      "  Num batches: 3\n",
      "  Average loss: 0.049472\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-21.3111, 20.8556]\n",
      "  Loss value: 1.504140\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 2.223685\n",
      "  Num batches: 2\n",
      "  Average loss: 1.111842\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:20,541] Trial 3 finished with value: 1.1118423342704773 and parameters: {'learning_rate': 0.00134274655954635, 'batch_size': 32, 'weight_decay': 0.00016269608918558, 'scheduler_step_size': 25}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 40 batches\n",
      "  Validation: 10 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [0.2184, 0.2397]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.703842\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-0.8326, 0.9830]\n",
      "  Loss value: 0.602201\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-3.3571, 3.4258]\n",
      "  Loss value: 0.650633\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-6.5231, 7.1754]\n",
      "  Loss value: 1.341896\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 2.594729\n",
      "  Num batches: 3\n",
      "  Average loss: 0.864910\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-9.9662, 11.2633]\n",
      "  Loss value: 1.180356\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 3.227829\n",
      "  Num batches: 2\n",
      "  Average loss: 1.613915\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-7.2871, 9.0472]\n",
      "  Loss value: 0.565628\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-6.9424, 7.4731]\n",
      "  Loss value: 0.938178\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-5.7713, 7.2745]\n",
      "  Loss value: 0.104406\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 1.608212\n",
      "  Num batches: 3\n",
      "  Average loss: 0.536071\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-15.8946, 18.0904]\n",
      "  Loss value: 1.194589\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 2.718664\n",
      "  Num batches: 2\n",
      "  Average loss: 1.359332\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-6.6590, 7.8614]\n",
      "  Loss value: 0.176401\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-7.3455, 8.6772]\n",
      "  Loss value: 0.362338\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-6.9083, 9.6404]\n",
      "  Loss value: 0.200863\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.739602\n",
      "  Num batches: 3\n",
      "  Average loss: 0.246534\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-21.1715, 25.5615]\n",
      "  Loss value: 2.018798\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 6.127236\n",
      "  Num batches: 2\n",
      "  Average loss: 3.063618\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:24,436] Trial 4 finished with value: 1.3593321442604065 and parameters: {'learning_rate': 0.002063434095393264, 'batch_size': 16, 'weight_decay': 0.00015039833542256352, 'scheduler_step_size': 15}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.3672, -0.0161]\n",
      "Loss test - Labels: tensor([0], device='cuda:0')\n",
      "Loss test - Loss value: 0.884005\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.1057, 0.8799]\n",
      "  Loss value: 0.818846\n",
      "  Predicted classes: tensor([1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1,\n",
      "        1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0859, 1.3216]\n",
      "  Loss value: 0.442736\n",
      "  Predicted classes: tensor([1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.2336, 1.9651]\n",
      "  Loss value: 0.216012\n",
      "  Predicted classes: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.477594\n",
      "  Num batches: 3\n",
      "  Average loss: 0.492531\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.0299, 2.6620]\n",
      "  Loss value: 0.288056\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.567655\n",
      "  Num batches: 2\n",
      "  Average loss: 0.283828\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.3267, 3.0855]\n",
      "  Loss value: 0.066630\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.2607, 4.1883]\n",
      "  Loss value: 0.038116\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.8214, 3.5027]\n",
      "  Loss value: 0.013647\n",
      "  Predicted classes: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.118393\n",
      "  Num batches: 3\n",
      "  Average loss: 0.039464\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.6880, 5.2268]\n",
      "  Loss value: 0.284573\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.493075\n",
      "  Num batches: 2\n",
      "  Average loss: 0.246537\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.8055, 4.4452]\n",
      "  Loss value: 0.011534\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1,\n",
      "        0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-6.7397, 5.6757]\n",
      "  Loss value: 0.007341\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.9562, 4.8506]\n",
      "  Loss value: 0.002432\n",
      "  Predicted classes: tensor([1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.021307\n",
      "  Num batches: 3\n",
      "  Average loss: 0.007102\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-7.8382, 7.3441]\n",
      "  Loss value: 0.362065\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.568348\n",
      "  Num batches: 2\n",
      "  Average loss: 0.284174\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:31,978] Trial 5 finished with value: 0.2465372532606125 and parameters: {'learning_rate': 0.00038475854356550876, 'batch_size': 64, 'weight_decay': 1.7434891582673023e-05, 'scheduler_step_size': 23}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 20 batches\n",
      "  Validation: 5 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.0842, 0.2223]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.858043\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-0.8269, 0.9204]\n",
      "  Loss value: 0.766850\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1,\n",
      "        1, 0, 1, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-3.5557, 3.7724]\n",
      "  Loss value: 0.474333\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.9159, 10.0014]\n",
      "  Loss value: 1.006381\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0,\n",
      "        1, 0, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 2.247565\n",
      "  Num batches: 3\n",
      "  Average loss: 0.749188\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-23.0634, 22.9077]\n",
      "  Loss value: 6.131273\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 14.804287\n",
      "  Num batches: 2\n",
      "  Average loss: 7.402143\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-15.3044, 13.7250]\n",
      "  Loss value: 0.639599\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1,\n",
      "        1, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-17.4863, 16.3736]\n",
      "  Loss value: 0.357634\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 1, 0, 1, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.8480, 9.4405]\n",
      "  Loss value: 0.544618\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 1.541851\n",
      "  Num batches: 3\n",
      "  Average loss: 0.513950\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-23.7334, 22.7484]\n",
      "  Loss value: 4.341796\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 8.329846\n",
      "  Num batches: 2\n",
      "  Average loss: 4.164923\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-17.1453, 15.4020]\n",
      "  Loss value: 0.593133\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1,\n",
      "        1, 1, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-17.2055, 19.3027]\n",
      "  Loss value: 0.159139\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0,\n",
      "        0, 0, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-17.2079, 17.5622]\n",
      "  Loss value: 0.402113\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 1.154385\n",
      "  Num batches: 3\n",
      "  Average loss: 0.384795\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-19.6582, 19.7797]\n",
      "  Loss value: 2.230171\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 5.520278\n",
      "  Num batches: 2\n",
      "  Average loss: 2.760139\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:37,581] Trial 6 finished with value: 2.760138988494873 and parameters: {'learning_rate': 0.0025362751066851487, 'batch_size': 32, 'weight_decay': 0.0003816429895184096, 'scheduler_step_size': 24}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 40 batches\n",
      "  Validation: 10 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [0.0265, 0.0979]\n",
      "Loss test - Labels: tensor([0], device='cuda:0')\n",
      "Loss test - Loss value: 0.658053\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-0.7224, 0.3948]\n",
      "  Loss value: 0.774967\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-2.9180, 3.3261]\n",
      "  Loss value: 0.906300\n",
      "  Predicted classes: tensor([0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-6.6933, 6.7276]\n",
      "  Loss value: 0.452739\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 2.134006\n",
      "  Num batches: 3\n",
      "  Average loss: 0.711335\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-10.5072, 9.8830]\n",
      "  Loss value: 1.040587\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 1.649266\n",
      "  Num batches: 2\n",
      "  Average loss: 0.824633\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-5.0325, 4.6715]\n",
      "  Loss value: 1.104795\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-8.3660, 7.7974]\n",
      "  Loss value: 0.259301\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-8.6427, 6.9299]\n",
      "  Loss value: 0.048397\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 1.412494\n",
      "  Num batches: 3\n",
      "  Average loss: 0.470831\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-17.2874, 17.9155]\n",
      "  Loss value: 0.766165\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 3.174956\n",
      "  Num batches: 2\n",
      "  Average loss: 1.587478\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-8.7905, 7.7666]\n",
      "  Loss value: 0.923688\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-11.5122, 11.1350]\n",
      "  Loss value: 0.201270\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-8.8247, 8.8939]\n",
      "  Loss value: 0.051741\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 1.176700\n",
      "  Num batches: 3\n",
      "  Average loss: 0.392233\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([16, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([16, 2])\n",
      "  Outputs range: [-29.5427, 30.0158]\n",
      "  Loss value: 9.628922\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 14.172879\n",
      "  Num batches: 2\n",
      "  Average loss: 7.086440\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:41,579] Trial 7 finished with value: 0.8246330618858337 and parameters: {'learning_rate': 0.002423217027026512, 'batch_size': 16, 'weight_decay': 0.00025654588640400825, 'scheduler_step_size': 16}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 20 batches\n",
      "  Validation: 5 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.3269, 0.4252]\n",
      "Loss test - Labels: tensor([0], device='cuda:0')\n",
      "Loss test - Loss value: 0.386195\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,\n",
      "        0, 0, 1, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-0.7850, 0.6064]\n",
      "  Loss value: 0.665530\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-3.2110, 3.2949]\n",
      "  Loss value: 0.348382\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 1, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-3.8188, 3.7568]\n",
      "  Loss value: 0.484424\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.498336\n",
      "  Num batches: 3\n",
      "  Average loss: 0.499445\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-12.9226, 11.6862]\n",
      "  Loss value: 5.028039\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 11.870135\n",
      "  Num batches: 2\n",
      "  Average loss: 5.935067\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,\n",
      "        0, 0, 1, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-5.1077, 5.2347]\n",
      "  Loss value: 0.707402\n",
      "  Predicted classes: tensor([1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-6.7880, 6.4693]\n",
      "  Loss value: 0.119206\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.0136, 9.1299]\n",
      "  Loss value: 0.094529\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.921137\n",
      "  Num batches: 3\n",
      "  Average loss: 0.307046\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-18.3909, 17.8730]\n",
      "  Loss value: 2.153625\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 2.906550\n",
      "  Num batches: 2\n",
      "  Average loss: 1.453275\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,\n",
      "        0, 0, 1, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.6283, 9.0747]\n",
      "  Loss value: 0.191914\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,\n",
      "        0, 0, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-11.3663, 10.5650]\n",
      "  Loss value: 0.315473\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 1, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-9.6397, 10.4494]\n",
      "  Loss value: 0.004135\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.511522\n",
      "  Num batches: 3\n",
      "  Average loss: 0.170507\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-13.3239, 12.5096]\n",
      "  Loss value: 3.385638\n",
      "  Predicted classes: tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 3.941339\n",
      "  Num batches: 2\n",
      "  Average loss: 1.970669\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:46,962] Trial 8 finished with value: 1.4532747566699982 and parameters: {'learning_rate': 0.0015973220927849813, 'batch_size': 32, 'weight_decay': 1.382708187864578e-05, 'scheduler_step_size': 17}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 20 batches\n",
      "  Validation: 5 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.2519, -0.0528]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.797614\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-1.0002, 0.7987]\n",
      "  Loss value: 0.706595\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-2.5431, 2.1778]\n",
      "  Loss value: 0.343484\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-4.8350, 5.1892]\n",
      "  Loss value: 0.238648\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.288728\n",
      "  Num batches: 3\n",
      "  Average loss: 0.429576\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.5825, 8.5220]\n",
      "  Loss value: 0.387610\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.692318\n",
      "  Num batches: 2\n",
      "  Average loss: 0.346159\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.2524, 7.3932]\n",
      "  Loss value: 0.277009\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-7.2299, 7.2558]\n",
      "  Loss value: 0.047389\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.8219, 9.2704]\n",
      "  Loss value: 0.110110\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.434508\n",
      "  Num batches: 3\n",
      "  Average loss: 0.144836\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-20.2963, 16.6854]\n",
      "  Loss value: 0.083195\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.914513\n",
      "  Num batches: 2\n",
      "  Average loss: 0.457256\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-8.4119, 8.1730]\n",
      "  Loss value: 0.101822\n",
      "  Predicted classes: tensor([1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1,\n",
      "        0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-11.4701, 11.3033]\n",
      "  Loss value: 0.030856\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-10.7719, 10.2475]\n",
      "  Loss value: 0.099502\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.232180\n",
      "  Num batches: 3\n",
      "  Average loss: 0.077393\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([32, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([32, 2])\n",
      "  Outputs range: [-23.0042, 20.9074]\n",
      "  Loss value: 1.735254\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 3.931170\n",
      "  Num batches: 2\n",
      "  Average loss: 1.965585\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:22:53,077] Trial 9 finished with value: 0.3461587727069855 and parameters: {'learning_rate': 0.0014326666677439764, 'batch_size': 32, 'weight_decay': 1.4830465635411714e-05, 'scheduler_step_size': 12}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.1171, 0.2141]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.541181\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.2189, 1.1818]\n",
      "  Loss value: 0.821820\n",
      "  Predicted classes: tensor([1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0,\n",
      "        0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0920, 1.7174]\n",
      "  Loss value: 0.341640\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.0204, 2.6026]\n",
      "  Loss value: 0.236213\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.399672\n",
      "  Num batches: 3\n",
      "  Average loss: 0.466557\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.8568, 4.9207]\n",
      "  Loss value: 0.215641\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.660034\n",
      "  Num batches: 2\n",
      "  Average loss: 0.330017\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.8269, 4.3256]\n",
      "  Loss value: 0.073311\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.2708, 5.0134]\n",
      "  Loss value: 0.024849\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-7.7759, 6.2153]\n",
      "  Loss value: 0.016911\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.115071\n",
      "  Num batches: 3\n",
      "  Average loss: 0.038357\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-7.7078, 9.2767]\n",
      "  Loss value: 0.218633\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.653739\n",
      "  Num batches: 2\n",
      "  Average loss: 0.326869\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-6.6647, 5.3236]\n",
      "  Loss value: 0.012738\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-6.9626, 7.6424]\n",
      "  Loss value: 0.003966\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1,\n",
      "        0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-9.2902, 8.1800]\n",
      "  Loss value: 0.003653\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1,\n",
      "        0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0,\n",
      "        0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.020358\n",
      "  Num batches: 3\n",
      "  Average loss: 0.006786\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-9.9010, 11.6058]\n",
      "  Loss value: 0.314557\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.631137\n",
      "  Num batches: 2\n",
      "  Average loss: 0.315568\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:23:00,346] Trial 10 finished with value: 0.3155684471130371 and parameters: {'learning_rate': 0.0005890122759447072, 'batch_size': 64, 'weight_decay': 0.0009734336961125906, 'scheduler_step_size': 21}. Best is trial 1 with value: 0.2464473992586136.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.0717, 0.1994]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.837862\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-0.9524, 0.9301]\n",
      "  Loss value: 0.789982\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.4869, 1.3576]\n",
      "  Loss value: 0.398707\n",
      "  Predicted classes: tensor([0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.6047, 2.7009]\n",
      "  Loss value: 0.271036\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.459725\n",
      "  Num batches: 3\n",
      "  Average loss: 0.486575\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.5402, 2.9561]\n",
      "  Loss value: 0.263807\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.511965\n",
      "  Num batches: 2\n",
      "  Average loss: 0.255983\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.6083, 3.3310]\n",
      "  Loss value: 0.085906\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.7244, 3.4375]\n",
      "  Loss value: 0.041481\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.6699, 4.1257]\n",
      "  Loss value: 0.031699\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.159086\n",
      "  Num batches: 3\n",
      "  Average loss: 0.053029\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.1053, 4.9770]\n",
      "  Loss value: 0.296169\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.473170\n",
      "  Num batches: 2\n",
      "  Average loss: 0.236585\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.1538, 4.2777]\n",
      "  Loss value: 0.015732\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0,\n",
      "        0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0,\n",
      "        0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.5788, 4.2827]\n",
      "  Loss value: 0.009633\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,\n",
      "        0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.9728, 5.1709]\n",
      "  Loss value: 0.005473\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.030838\n",
      "  Num batches: 3\n",
      "  Average loss: 0.010279\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.4056, 6.5271]\n",
      "  Loss value: 0.349994\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.506427\n",
      "  Num batches: 2\n",
      "  Average loss: 0.253214\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:23:07,458] Trial 11 finished with value: 0.23658496141433716 and parameters: {'learning_rate': 0.00038225687078265446, 'batch_size': 64, 'weight_decay': 4.54892469704785e-05, 'scheduler_step_size': 21}. Best is trial 11 with value: 0.23658496141433716.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.2493, -0.0944]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 0.773560\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.3847, 1.1273]\n",
      "  Loss value: 0.699476\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.6848, 1.3405]\n",
      "  Loss value: 0.436845\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0,\n",
      "        0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0713, 1.8262]\n",
      "  Loss value: 0.326432\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0,\n",
      "        1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.462753\n",
      "  Num batches: 3\n",
      "  Average loss: 0.487584\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.0670, 2.7008]\n",
      "  Loss value: 0.346106\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.726728\n",
      "  Num batches: 2\n",
      "  Average loss: 0.363364\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.5589, 2.6836]\n",
      "  Loss value: 0.117637\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.1190, 3.1803]\n",
      "  Loss value: 0.102366\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.2596, 3.8550]\n",
      "  Loss value: 0.073404\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.293408\n",
      "  Num batches: 3\n",
      "  Average loss: 0.097803\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.9310, 5.2190]\n",
      "  Loss value: 0.300158\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.649893\n",
      "  Num batches: 2\n",
      "  Average loss: 0.324947\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.6942, 3.7216]\n",
      "  Loss value: 0.035887\n",
      "  Predicted classes: tensor([1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.5894, 3.9518]\n",
      "  Loss value: 0.024073\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0,\n",
      "        0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.0979, 3.8818]\n",
      "  Loss value: 0.018024\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.077984\n",
      "  Num batches: 3\n",
      "  Average loss: 0.025995\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.5759, 6.9995]\n",
      "  Loss value: 0.306566\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.639031\n",
      "  Num batches: 2\n",
      "  Average loss: 0.319515\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:23:14,808] Trial 12 finished with value: 0.3195154070854187 and parameters: {'learning_rate': 0.00023270619275904834, 'batch_size': 64, 'weight_decay': 5.269120025879005e-05, 'scheduler_step_size': 20}. Best is trial 11 with value: 0.23658496141433716.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.1614, 0.0115]\n",
      "Loss test - Labels: tensor([0], device='cuda:0')\n",
      "Loss test - Loss value: 0.783359\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-0.9836, 0.9553]\n",
      "  Loss value: 0.698085\n",
      "  Predicted classes: tensor([0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1,\n",
      "        1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1,\n",
      "        1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-2.1103, 2.4064]\n",
      "  Loss value: 0.366929\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n",
      "        1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-3.2213, 3.6487]\n",
      "  Loss value: 0.273176\n",
      "  Predicted classes: tensor([0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,\n",
      "        0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 1.338191\n",
      "  Num batches: 3\n",
      "  Average loss: 0.446064\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.0796, 5.0610]\n",
      "  Loss value: 0.266969\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 0.551386\n",
      "  Num batches: 2\n",
      "  Average loss: 0.275693\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.3764, 3.8929]\n",
      "  Loss value: 0.076934\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.9993, 5.2534]\n",
      "  Loss value: 0.036832\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-4.7553, 4.5937]\n",
      "  Loss value: 0.009204\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 0.122971\n",
      "  Num batches: 3\n",
      "  Average loss: 0.040990\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-7.8526, 8.3142]\n",
      "  Loss value: 0.348735\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 0.499638\n",
      "  Num batches: 2\n",
      "  Average loss: 0.249819\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-5.4794, 5.4664]\n",
      "  Loss value: 0.008120\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-7.3545, 6.6742]\n",
      "  Loss value: 0.006477\n",
      "  Predicted classes: tensor([1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0,\n",
      "        1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-6.2126, 5.4977]\n",
      "  Loss value: 0.001872\n",
      "  Predicted classes: tensor([0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0,\n",
      "        1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0,\n",
      "        0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 0.016469\n",
      "  Num batches: 3\n",
      "  Average loss: 0.005490\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-9.4237, 10.0676]\n",
      "  Loss value: 0.452880\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 0.752954\n",
      "  Num batches: 2\n",
      "  Average loss: 0.376477\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:23:22,359] Trial 13 finished with value: 0.24981878697872162 and parameters: {'learning_rate': 0.0006390000976512851, 'batch_size': 64, 'weight_decay': 6.003724978645596e-05, 'scheduler_step_size': 21}. Best is trial 11 with value: 0.23658496141433716.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created data loaders:\n",
      "  Training: 10 batches\n",
      "  Validation: 3 batches\n",
      "[INFO] Using default hyperparameters\n",
      "Model initialized on device: cuda\n",
      "Total parameters: 2,226,434\n",
      "Learning rate: 0.001000\n",
      "Weight decay: 0.000100\n",
      "Loss function: CrossEntropyLoss()\n",
      "Early stopping patience: 15\n",
      "Early stopping min delta: 0.0005\n",
      "Model test - Input shape: torch.Size([1, 3, 160, 160])\n",
      "Model test - Output shape: torch.Size([1, 2])\n",
      "Model test - Output range: [-0.5231, 0.0320]\n",
      "Loss test - Labels: tensor([1], device='cuda:0')\n",
      "Loss test - Loss value: 1.008780\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-1.5857, 1.4648]\n",
      "  Loss value: 0.661834\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-6.1705, 5.5451]\n",
      "  Loss value: 1.841697\n",
      "  Predicted classes: tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-15.7330, 14.2551]\n",
      "  Loss value: 0.895331\n",
      "  Predicted classes: tensor([1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 0:\n",
      "  Total loss: 3.398862\n",
      "  Num batches: 3\n",
      "  Average loss: 1.132954\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-26.1863, 20.1697]\n",
      "  Loss value: 11.848977\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 0:\n",
      "  Total loss: 16.697757\n",
      "  Num batches: 2\n",
      "  Average loss: 8.348879\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-17.2312, 14.2954]\n",
      "  Loss value: 1.814825\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1,\n",
      "        1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-34.8092, 28.5510]\n",
      "  Loss value: 0.270761\n",
      "  Predicted classes: tensor([0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1,\n",
      "        1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-27.1715, 24.7293]\n",
      "  Loss value: 0.353405\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1], device='cuda:0')\n",
      "[DEBUG] Training epoch 1:\n",
      "  Total loss: 2.438990\n",
      "  Num batches: 3\n",
      "  Average loss: 0.812997\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-54.2294, 47.6772]\n",
      "  Loss value: 79.117500\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 1:\n",
      "  Total loss: 107.574532\n",
      "  Num batches: 2\n",
      "  Average loss: 53.787266\n",
      "[DEBUG] Training batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0,\n",
      "        0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-22.6950, 19.6162]\n",
      "  Loss value: 1.557850\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,\n",
      "        0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 1:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1,\n",
      "        1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-26.7939, 23.6464]\n",
      "  Loss value: 0.796884\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0,\n",
      "        1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0], device='cuda:0')\n",
      "[DEBUG] Training batch 2:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,\n",
      "        0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-20.1077, 18.4048]\n",
      "  Loss value: 0.426077\n",
      "  Predicted classes: tensor([0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1,\n",
      "        1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0,\n",
      "        0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Training epoch 2:\n",
      "  Total loss: 2.780811\n",
      "  Num batches: 3\n",
      "  Average loss: 0.926937\n",
      "[DEBUG] Validation batch 0:\n",
      "  Images shape: torch.Size([64, 3, 160, 160])\n",
      "  Labels: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n",
      "        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], device='cuda:0')\n",
      "  Outputs shape: torch.Size([64, 2])\n",
      "  Outputs range: [-49.9129, 44.0164]\n",
      "  Loss value: 70.627441\n",
      "  Predicted classes: tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n",
      "        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], device='cuda:0')\n",
      "[DEBUG] Validation epoch 2:\n",
      "  Total loss: 96.002842\n",
      "  Num batches: 2\n",
      "  Average loss: 48.001421\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2025-07-29 01:23:30,092] Trial 14 finished with value: 8.348878622055054 and parameters: {'learning_rate': 0.004838997117518596, 'batch_size': 64, 'weight_decay': 2.8704858915856277e-05, 'scheduler_step_size': 22}. Best is trial 11 with value: 0.23658496141433716.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Best trial:\n",
      "  Value: 0.23658496141433716\n",
      "  Params: {'learning_rate': 0.00038225687078265446, 'batch_size': 64, 'weight_decay': 4.54892469704785e-05, 'scheduler_step_size': 21}\n",
      "Best hyperparameters saved to ./output/best_hyperparameters.json\n",
      "Best learning rate saved to ./output/best_learning_rate.txt\n",
      "\n",
      "Hyperparameter Tuning Summary:\n",
      "  Best Learning Rate: 0.000382\n",
      "  Best Batch Size: 64\n",
      "  Best Weight Decay: 0.000045\n",
      "  Best Scheduler Step Size: 21\n",
      "  Best Validation Loss: 0.2366\n"
     ]
    }
   ],
   "source": [
    "\"\"\"\n",
    "Hyperparameter Tuning Script for Facial Detection System\n",
    "Uses Optuna to tune multiple important hyperparameters\n",
    "\"\"\"\n",
    "\n",
    "import os\n",
    "import optuna\n",
    "import torch\n",
    "# from config import Config\n",
    "# from data_loader_utils import create_data_loaders\n",
    "# from model_training import FaceRecognitionModel, ModelTrainer\n",
    "\n",
    "def objective(trial):\n",
    "    # Suggest multiple hyperparameters (optimized for larger dataset)\n",
    "    learning_rate = trial.suggest_float('learning_rate', 1e-4, 5e-3, log=True)\n",
    "    batch_size = trial.suggest_categorical('batch_size', [16, 32, 64])\n",
    "    weight_decay = trial.suggest_float('weight_decay', 1e-5, 1e-3, log=True)\n",
    "    scheduler_step_size = trial.suggest_int('scheduler_step_size', 8, 25)\n",
    "    \n",
    "    # Load data loaders with custom batch size\n",
    "    train_loader, val_loader = create_data_loaders(batch_size=batch_size)\n",
    "    \n",
    "    # Check if data loaders are empty\n",
    "    if len(train_loader) == 0:\n",
    "        print(f\"[ERROR] Training loader is empty. Skipping trial.\")\n",
    "        return float('inf')  # Return worst possible value\n",
    "    \n",
    "    if len(val_loader) == 0:\n",
    "        print(f\"[ERROR] Validation loader is empty. Skipping trial.\")\n",
    "        return float('inf')\n",
    "    \n",
    "    # Use a smaller number of batches for tuning\n",
    "    train_loader_iter = iter(train_loader)\n",
    "    val_loader_iter = iter(val_loader)\n",
    "    \n",
    "    # Create small loaders with proper batch format\n",
    "    small_train_batches = []\n",
    "    small_val_batches = []\n",
    "    \n",
    "    # Get a few batches from training\n",
    "    for _ in range(min(3, len(train_loader))):\n",
    "        try:\n",
    "            batch = next(train_loader_iter)\n",
    "            small_train_batches.append(batch)\n",
    "        except StopIteration:\n",
    "            break\n",
    "    \n",
    "    # Get a few batches from validation\n",
    "    for _ in range(min(2, len(val_loader))):\n",
    "        try:\n",
    "            batch = next(val_loader_iter)\n",
    "            small_val_batches.append(batch)\n",
    "        except StopIteration:\n",
    "            break\n",
    "    \n",
    "    # Initialize model\n",
    "    model = FaceRecognitionModel(num_classes=Config.NUM_CLASSES, pretrained=Config.PRETRAINED)\n",
    "    \n",
    "    # Trainer with custom hyperparameters\n",
    "    trainer = ModelTrainer(model, train_loader, val_loader)\n",
    "    trainer.optimizer = torch.optim.AdamW(\n",
    "        model.parameters(),\n",
    "        lr=learning_rate,\n",
    "        weight_decay=weight_decay\n",
    "    )\n",
    "    trainer.scheduler = torch.optim.lr_scheduler.StepLR(\n",
    "        trainer.optimizer,\n",
    "        step_size=scheduler_step_size,\n",
    "        gamma=Config.SCHEDULER_GAMMA\n",
    "    )\n",
    "    \n",
    "    # Train for a few epochs only\n",
    "    best_val_loss = float('inf')\n",
    "    try:\n",
    "        for epoch in range(3):\n",
    "            # Create temporary data loaders with small batches\n",
    "            class SmallDataLoader:\n",
    "                def __init__(self, batches):\n",
    "                    self.batches = batches\n",
    "                    self.length = len(batches)\n",
    "                \n",
    "                def __iter__(self):\n",
    "                    return iter(self.batches)\n",
    "                \n",
    "                def __len__(self):\n",
    "                    return self.length\n",
    "            \n",
    "            trainer.train_loader = SmallDataLoader(small_train_batches)\n",
    "            trainer.val_loader = SmallDataLoader(small_val_batches)\n",
    "            \n",
    "            train_loss = trainer.train_epoch(epoch)\n",
    "            val_loss = trainer.validate_epoch(epoch)\n",
    "            if val_loss < best_val_loss:\n",
    "                best_val_loss = val_loss\n",
    "    except Exception as e:\n",
    "        print(f\"[ERROR] Training failed: {e}\")\n",
    "        return float('inf')\n",
    "    \n",
    "    return best_val_loss\n",
    "\n",
    "def main():\n",
    "    print(\"=== Hyperparameter Tuning: Multiple Parameters (Optuna) ===\")\n",
    "    \n",
    "    # Create output directory if it doesn't exist\n",
    "    os.makedirs(Config.OUTPUT_DIR, exist_ok=True)\n",
    "    \n",
    "    # Test data loading first\n",
    "    print(\"Testing data loading...\")\n",
    "    try:\n",
    "        test_train_loader, test_val_loader = create_data_loaders(batch_size=16)\n",
    "        print(f\"Data loading test successful:\")\n",
    "        print(f\"  Training batches: {len(test_train_loader)}\")\n",
    "        print(f\"  Validation batches: {len(test_val_loader)}\")\n",
    "        \n",
    "        if len(test_train_loader) == 0:\n",
    "            print(\"[ERROR] No training data found. Please check your dataset.\")\n",
    "            return\n",
    "            \n",
    "    except Exception as e:\n",
    "        print(f\"[ERROR] Data loading failed: {e}\")\n",
    "        return\n",
    "    \n",
    "    study = optuna.create_study(direction=\"minimize\", study_name=\"hyperparameter_tuning\")\n",
    "    study.optimize(objective, n_trials=15)  # Increased trials for multiple parameters\n",
    "    \n",
    "    print(\"\\nBest trial:\")\n",
    "    trial = study.best_trial\n",
    "    print(f\"  Value: {trial.value}\")\n",
    "    print(f\"  Params: {trial.params}\")\n",
    "    \n",
    "    # Save best hyperparameters to file\n",
    "    best_params_path = os.path.join(Config.OUTPUT_DIR, \"best_hyperparameters.json\")\n",
    "    import json\n",
    "    with open(best_params_path, \"w\") as f:\n",
    "        json.dump(trial.params, f, indent=2)\n",
    "    \n",
    "    # Also save individual parameters for backward compatibility\n",
    "    best_lr_path = os.path.join(Config.OUTPUT_DIR, \"best_learning_rate.txt\")\n",
    "    with open(best_lr_path, \"w\") as f:\n",
    "        f.write(str(trial.params['learning_rate']))\n",
    "    \n",
    "    print(f\"Best hyperparameters saved to {best_params_path}\")\n",
    "    print(f\"Best learning rate saved to {best_lr_path}\")\n",
    "    \n",
    "    # Print summary\n",
    "    print(\"\\nHyperparameter Tuning Summary:\")\n",
    "    print(f\"  Best Learning Rate: {trial.params['learning_rate']:.6f}\")\n",
    "    print(f\"  Best Batch Size: {trial.params['batch_size']}\")\n",
    "    print(f\"  Best Weight Decay: {trial.params['weight_decay']:.6f}\")\n",
    "    print(f\"  Best Scheduler Step Size: {trial.params['scheduler_step_size']}\")\n",
    "    print(f\"  Best Validation Loss: {trial.value:.4f}\")\n",
    "\n",
    "if __name__ == \"__main__\":\n",
    "    main() "
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "gpu",
   "dataSources": [
    {
     "datasetId": 7961995,
     "sourceId": 12605156,
     "sourceType": "datasetVersion"
    },
    {
     "sourceId": 253035811,
     "sourceType": "kernelVersion"
    }
   ],
   "dockerImageVersionId": 31090,
   "isGpuEnabled": true,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 209.491766,
   "end_time": "2025-07-29T01:23:33.754074",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-07-29T01:20:04.262308",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
